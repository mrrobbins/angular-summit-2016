code from Yakov Fain, Farata Systems